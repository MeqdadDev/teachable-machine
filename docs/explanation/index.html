<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Explanation - Teachable Machine Package - Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Explanation";
        var mkdocs_page_input_path = "explanation.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Teachable Machine Package - Documentation
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Teachable Machine - Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../how-to-guide/">How-To Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../requirements/">Requirements</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../codeExamples/">Code Examples</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Explanation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#package-components">Package Components</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../contribution/">Contributing</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Teachable Machine Package - Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Explanation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="explanation">Explanation</h2>
<h3 id="package-components">Package Components</h3>


<div class="doc doc-object doc-module">



<a id="src.teachable_machine"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.teachable_machine.TeachableMachine" class="doc doc-heading">
            <code>TeachableMachine</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


      <p>Create a TeachableMachine object to run pre-trained AI models.</p>

              <details class="quote">
                <summary>Source code in <code>src/teachable_machine.py</code></summary>
                <pre class="highlight"><code class="language-python">class TeachableMachine(object):
    """
    Create a TeachableMachine object to run pre-trained AI models.
    """

    SUPPORTED_TYPES = {"keras", "h5"}
    IMAGE_SIZE = (224, 224)

    def __init__(
        self,
        model_path="keras_model.h5",
        labels_file_path="labels.txt",
        model_type="h5",
    ) -&gt; None:
        self._model_type = model_type.lower()
        if self._model_type not in self.SUPPORTED_TYPES:
            raise ValueError(
                f"Unsupported model type: {self._model_type}. Use 'keras' or 'h5'."
            )
        np.set_printoptions(suppress=True)

        self._load_model(model_path)
        self._load_labels(labels_file_path)
        print("Teachable Machine Object is created successfully.")

    def _load_model(self, model_path: str):
        try:
            self._model = load_model(model_path, compile=False)
        except IOError as e:
            print("LoadingModelError: Error while loading Teachable Machine model")
            raise IOError("Error loading model") from e
        except Exception as e:
            print("LoadingModelError: Error while loading Teachable Machine model")
            raise FileNotFoundError("Model file not found") from e

    def _load_labels(self, labels_file_path):
        try:
            with open(labels_file_path, "r") as file:
                self._labels = file.readlines()
        except IOError as e:
            print("LoadingLabelsError: Error while loading labels.txt file")
            raise IOError("Error loading labels") from e
        except Exception as e:
            print("LoadingLabelsError: Error while loading labels.txt file")
            raise FileNotFoundError("Labels file not found") from e

    def _open_image(self, image_path):
        """
        Open an image file and convert it to RGB mode.

        Parameters:
        image_path (str): Path to the image file.

        Returns:
        PIL.Image.Image: Opened image in RGB mode.
        """
        try:
            return Image.open(image_path).convert("RGB")
        except FileNotFoundError as e:
            print("ImageNotFound: Error in image file.")
            raise FileNotFoundError("Image file not found") from e
        except Exception as e:
            print("ImageTypeError: Error while opening or converting image")
            raise TypeError("Unsupported image type") from e

    def classify_image(self, image_path: str):
        """
        Classify an image using the pre-trained model.

        Parameters:
        image_path (str): Path of the image to be classified.

        Returns:
        dict: Classification results including class name, index, confidence and predictions.
        """
        image = self._open_image(image_path)
        return self._get_image_classification(image)

    def _get_image_classification(self, image):
        data = self._preprocess_image(image)
        prediction = self._model.predict(data)
        class_index = np.argmax(prediction)
        class_name = self._labels[class_index].strip()
        class_confidence = prediction[0][class_index]

        return {
            "class_name": class_name,
            "highest_class_name": class_name,
            "highest_class_id": class_index,
            "class_index": class_index,
            "class_id": class_index,
            "predictions": prediction[0],
            "all_predictions": prediction[0],
            "class_confidence": class_confidence,
            "highest_class_confidence": class_confidence,
        }

    def _preprocess_image(self, image):
        image = ImageOps.fit(image, self.IMAGE_SIZE, Image.Resampling.LANCZOS)
        image_array = np.asarray(image)
        normalized_image_array = (image_array.astype(np.float32) / 127.5) - 1
        return np.expand_dims(normalized_image_array, axis=0)

    def classify_and_show(self, image_path: str, convert_to_bgr=True):
        """
        Classify an image and show the prediction results on the image.

        Parameters:
        image_path (str): Path of the input image to be classified.
        convert_to_bgr (bool, optional): Whether to convert the image to BGR format for OpenCV.
            If False, the image will be returned in RGB format. Default is True.

        Returns:
        tuple: (classification_result, image_with_prediction)
            classification_result (dict): Classification results including class name, index, confidence and predictions.
            image_with_prediction (np.ndarray or PIL.Image.Image): The image with prediction results drawn on it.
                Returns a NumPy array in BGR format if convert_to_bgr is True.
                Otherwise, returns a PIL.Image.Image in RGB format.
        """
        classification_result = self.classify_image(image_path)
        image_with_prediction = self.show_prediction_on_image(
            image_path, classification_result, convert_to_bgr=convert_to_bgr
        )
        return classification_result, image_with_prediction

    def show_prediction_on_image(
        self, image_path: str, classification_result=None, convert_to_bgr=True
    ):
        """
        Show the prediction results on the image and return the modified image.

        Parameters:
        image_path (str): Path of the input image to be classified.
        classification_result (dict, optional): Pre-computed classification result.
            If not provided, the method will classify the image.
        convert_to_bgr (bool, optional): Whether to convert the image to BGR format for OpenCV.
            If False, the image will be returned in RGB format. Default is True.

        Returns:
        np.ndarray or PIL.Image.Image: The image with prediction results drawn on it.
            Returns a NumPy array in BGR format if convert_to_bgr is True.
            Otherwise, returns a PIL.Image.Image in RGB format.
        """
        image = self._open_image(image_path)

        if classification_result is None:
            classification_result = self._get_image_classification(image)

        class_name = classification_result["class_name"]
        confidence = classification_result["class_confidence"]
        confidence_percent = confidence * 100
        text = f"{class_name}: {confidence_percent:.2f}%"

        draw = ImageDraw.Draw(image)

        font_size = int(image.height * 0.04)  # 4% of the image height
        font = ImageFont.truetype("DejaVuSans-Bold.ttf", font_size)

        text_width, text_height = draw.textsize(text, font=font)
        position = (10, image.height - text_height - 10)

        draw.rectangle(
            [
                position[0],
                position[1],
                position[0] + text_width,
                position[1] + text_height,
            ],
            fill=(0, 0, 0, 128),
        )

        draw.text(position, text, font=font, fill=(255, 255, 255))

        if convert_to_bgr:
            image_2_numpy_arr = np.array(image)

            # Convert RGB to BGR
            image_2_numpy_arr = image_2_numpy_arr[:, :, ::-1]
            return image_2_numpy_arr

        return image</code></pre>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.teachable_machine.TeachableMachine.classify_and_show" class="doc doc-heading">
            <code class="highlight language-python">classify_and_show(image_path, convert_to_bgr=True)</code>

</h3>


    <div class="doc doc-contents ">

      <p>Classify an image and show the prediction results on the image.</p>
<p>Parameters:
image_path (str): Path of the input image to be classified.
convert_to_bgr (bool, optional): Whether to convert the image to BGR format for OpenCV.
    If False, the image will be returned in RGB format. Default is True.</p>
      <p>tuple: (classification_result, image_with_prediction)
    classification_result (dict): Classification results including class name, index, confidence and predictions.
    image_with_prediction (np.ndarray or PIL.Image.Image): The image with prediction results drawn on it.
        Returns a NumPy array in BGR format if convert_to_bgr is True.
        Otherwise, returns a PIL.Image.Image in RGB format.</p>

            <details class="quote">
              <summary>Source code in <code>src/teachable_machine.py</code></summary>
              <pre class="highlight"><code class="language-python">def classify_and_show(self, image_path: str, convert_to_bgr=True):
    """
    Classify an image and show the prediction results on the image.

    Parameters:
    image_path (str): Path of the input image to be classified.
    convert_to_bgr (bool, optional): Whether to convert the image to BGR format for OpenCV.
        If False, the image will be returned in RGB format. Default is True.

    Returns:
    tuple: (classification_result, image_with_prediction)
        classification_result (dict): Classification results including class name, index, confidence and predictions.
        image_with_prediction (np.ndarray or PIL.Image.Image): The image with prediction results drawn on it.
            Returns a NumPy array in BGR format if convert_to_bgr is True.
            Otherwise, returns a PIL.Image.Image in RGB format.
    """
    classification_result = self.classify_image(image_path)
    image_with_prediction = self.show_prediction_on_image(
        image_path, classification_result, convert_to_bgr=convert_to_bgr
    )
    return classification_result, image_with_prediction</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.teachable_machine.TeachableMachine.classify_image" class="doc doc-heading">
            <code class="highlight language-python">classify_image(image_path)</code>

</h3>


    <div class="doc doc-contents ">

      <p>Classify an image using the pre-trained model.</p>
<p>Parameters:
image_path (str): Path of the image to be classified.</p>
<p>Returns:
dict: Classification results including class name, index, confidence and predictions.</p>

            <details class="quote">
              <summary>Source code in <code>src/teachable_machine.py</code></summary>
              <pre class="highlight"><code class="language-python">def classify_image(self, image_path: str):
    """
    Classify an image using the pre-trained model.

    Parameters:
    image_path (str): Path of the image to be classified.

    Returns:
    dict: Classification results including class name, index, confidence and predictions.
    """
    image = self._open_image(image_path)
    return self._get_image_classification(image)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.teachable_machine.TeachableMachine.show_prediction_on_image" class="doc doc-heading">
            <code class="highlight language-python">show_prediction_on_image(image_path, classification_result=None, convert_to_bgr=True)</code>

</h3>


    <div class="doc doc-contents ">

      <p>Show the prediction results on the image and return the modified image.</p>
<p>Parameters:
image_path (str): Path of the input image to be classified.
classification_result (dict, optional): Pre-computed classification result.
    If not provided, the method will classify the image.
convert_to_bgr (bool, optional): Whether to convert the image to BGR format for OpenCV.
    If False, the image will be returned in RGB format. Default is True.</p>
      <p>np.ndarray or PIL.Image.Image: The image with prediction results drawn on it.
    Returns a NumPy array in BGR format if convert_to_bgr is True.
    Otherwise, returns a PIL.Image.Image in RGB format.</p>

            <details class="quote">
              <summary>Source code in <code>src/teachable_machine.py</code></summary>
              <pre class="highlight"><code class="language-python">def show_prediction_on_image(
    self, image_path: str, classification_result=None, convert_to_bgr=True
):
    """
    Show the prediction results on the image and return the modified image.

    Parameters:
    image_path (str): Path of the input image to be classified.
    classification_result (dict, optional): Pre-computed classification result.
        If not provided, the method will classify the image.
    convert_to_bgr (bool, optional): Whether to convert the image to BGR format for OpenCV.
        If False, the image will be returned in RGB format. Default is True.

    Returns:
    np.ndarray or PIL.Image.Image: The image with prediction results drawn on it.
        Returns a NumPy array in BGR format if convert_to_bgr is True.
        Otherwise, returns a PIL.Image.Image in RGB format.
    """
    image = self._open_image(image_path)

    if classification_result is None:
        classification_result = self._get_image_classification(image)

    class_name = classification_result["class_name"]
    confidence = classification_result["class_confidence"]
    confidence_percent = confidence * 100
    text = f"{class_name}: {confidence_percent:.2f}%"

    draw = ImageDraw.Draw(image)

    font_size = int(image.height * 0.04)  # 4% of the image height
    font = ImageFont.truetype("DejaVuSans-Bold.ttf", font_size)

    text_width, text_height = draw.textsize(text, font=font)
    position = (10, image.height - text_height - 10)

    draw.rectangle(
        [
            position[0],
            position[1],
            position[0] + text_width,
            position[1] + text_height,
        ],
        fill=(0, 0, 0, 128),
    )

    draw.text(position, text, font=font, fill=(255, 255, 255))

    if convert_to_bgr:
        image_2_numpy_arr = np.array(image)

        # Convert RGB to BGR
        image_2_numpy_arr = image_2_numpy_arr[:, :, ::-1]
        return image_2_numpy_arr

    return image</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../codeExamples/" class="btn btn-neutral float-left" title="Code Examples"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../contribution/" class="btn btn-neutral float-right" title="Contributing">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../codeExamples/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../contribution/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
